argo-cd:
  dex:
    enabled: true
  server:
    extraArgs:
      - --insecure
    config:
      url: https://argo-cd.nicklasfrahm.xyz
      dex.config: |
        connectors:
          - type: github
            id: github
            name: GitHub
            config:
              clientID: 1435c46d92d31759da03
              clientSecret: $github-oauth:dex.github.clientSecret
              orgs:
                - name: nicklasfrahm-xyz
              teamNameField: slug
      policy.default: role:readonly
      policy.csv: |
        # Built-in policy which defines two roles: role:readonly and role:admin,
        # and additionally assigns the admin user to the role:admin role.
        # There are two policy formats:
        # 1. Applications (which belong to a project):
        # p, <user/group>, <resource>, <action>, <project>/<object>
        # 2. All other resources:
        # p, <user/group>, <resource>, <action>, <object>

        p, role:readonly, applications, get, */*, allow
        p, role:readonly, certificates, get, *, allow
        p, role:readonly, clusters, get, *, allow
        p, role:readonly, repositories, get, *, allow
        p, role:readonly, projects, get, *, allow
        p, role:readonly, accounts, get, *, allow
        p, role:readonly, gpgkeys, get, *, allow
        p, role:readonly, logs, get, */*, allow

        p, role:admin, applications, create, */*, allow
        p, role:admin, applications, update, */*, allow
        p, role:admin, applications, delete, */*, allow
        p, role:admin, applications, sync, */*, allow
        p, role:admin, applications, override, */*, allow
        p, role:admin, applications, action/*, */*, allow
        p, role:admin, certificates, create, *, allow
        p, role:admin, certificates, update, *, allow
        p, role:admin, certificates, delete, *, allow
        p, role:admin, clusters, create, *, allow
        p, role:admin, clusters, update, *, allow
        p, role:admin, clusters, delete, *, allow
        p, role:admin, repositories, create, *, allow
        p, role:admin, repositories, update, *, allow
        p, role:admin, repositories, delete, *, allow
        p, role:admin, projects, create, *, allow
        p, role:admin, projects, update, *, allow
        p, role:admin, projects, delete, *, allow
        p, role:admin, accounts, update, *, allow
        p, role:admin, gpgkeys, create, *, allow
        p, role:admin, gpgkeys, delete, *, allow
        p, role:admin, exec, create, */*, allow

        g, role:admin, role:readonly
        g, nicklasfrahm-xyz:argonauts, role:admin
      admin.enabled: "false"
    ingress:
      enabled: true
      ingressClassName: traefik-tph99
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-production
      hosts:
        - argo-cd.nicklasfrahm.xyz
      tls:
        - secretName: argocd-tls
          hosts:
            - argo-cd.nicklasfrahm.xyz
